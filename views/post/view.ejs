<html>
  <head>
    <%- include('../partials/head') %>
    <script src="/public/js/post/view.js"></script>
  </head>

  <body>
    <div class="wrap">
      <div class="header">
        <%- include('../partials/header') %>
      </div>
      <div class="content">
        <style>
          .content{
            background-color: #F8F8FF;
            width:100%;
            padding-top:30px;
            padding-bottom: 60px;
          }
          @media(min-width:750px){
            .post_area{
              margin-left: 5%;
              width: 90% !important;
            }
          }
          .post_area{
            border: 1px solid #dfe3e6;
            width: 750px;
            background-color: white;
          }
          .post_header{
            margin-left: 30px;
            margin-top: 30px;
            margin-right: 30px;
          }
          .post_type{
            border-bottom: 1px solid #dfe3e6;
            padding-bottom: 10px;
          }
          .post_type a{
            letter-spacing: 2px;
            font-size: 24px;
          }
          .post_titleAndsetting{
            margin-top:20px;
            margin-bottom:10px;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
          }

          .post_setting_btn{
            font-size: 30px;
            letter-spacing: 3px;
          }
          .dropdown_postmenu{
            left:0px;
            top:0px;
            width:80px;
            position: absolute;
            display: flex;
            flex-direction: column;
            border: 1px solid #dfe3e6;
            border-radius: 5px 5px;
            z-index: 2;
          }
          .dd_ps_child{
            text-align: center;
            padding-top:7px;
            padding-bottom:7px;
            font-size: 16px;
            background-color: white;
          }
          .dd_ps_child:hover{
            background-color: #dfe3e6;
          }

          .post_info{
            display:flex;
            justify-content: space-between;
            flex-direction: row;
            align-items: center;
          }
          .post_info_left{
            display:flex;
          }
          .post_userANDtime{
            margin-left: 10px;
          }
          .post_info_right{
            display:flex;
            justify-content: space-around;
            width: 160px;
            flex-direction: row;
          }
          .figure{
            text-decoration: none;
            color: black;
          }

          .post_body{
            margin-left: 30px;
            margin-right: 30px;
            margin-top: 30px;
          }

          .post_footer{
            margin-top: 30px;
            margin-left: 30px;
            margin-right: 30px;
            display: flex;
            flex-direction: column;
          }
          .comment_area{
            padding-bottom:30px;
          }
          .post_figure{
            margin-top: 10px;
            display: flex;
            align-items: center;
          }
          .comment_amount{
            font-size: 24px;
          }
          .like{
            color: #de0581 !important;
            font-size: 40px;
            margin-left: 10px;
          }
          .like_cmt{
            margin-top: 10px;
            font-size: 14px;
            margin-left: 7px;
            color: gray;
            opacity: 0%;
            transition-duration: 0.2s;
          }
          .delete_btn{
            float:right;
            margin-top:-20px;
          }
          .comments{
            border-top: 1px solid #dfe3e6;
            list-style: none;
            padding-left:0px;
            margin-top: 10px;
          }
          .comment{
            padding-top: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dfe3e6;
          }
          .comment_main{
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
          }
          .cmt_left{
            display: flex;
            flex-direction: row;
            margin-right: 10px;
            width: 100%;
          }
          .cmt_nickname{
            width:150px;
            cursor: pointer;
          }
          .cmt_content{
            cursor:pointer;
            width: 100%;
          }
          .cmt_right{
            display: flex;
            width: 130px;
          }
          .cmt_time{
            font-size: 14px;
            opacity: 50%;
            margin-right: 10px;
          }
          .cmt_time a{
            font-size: 12px;
          }
          .comment_setting_btn{
            margin-top:-7px;
            font-size: 20px;
          }
          .dropdown_commentmenu{
            left:0px;
            top:0px;
            width:60px;
            cursor: pointer;
            position: absolute;
            display: flex;
            flex-direction: column;
            border: 1px solid #dfe3e6;
            border-radius: 5px 5px;
            z-index: 2;
          }
          .dd_cs_child{
            text-align: center;
            padding-left:10px;
            padding-right:10px;
            padding-top:5px;
            padding-bottom:5px;
            font-size: 14px;
            background-color: white;
          }
          .dd_cs_child:hover{
            background-color: #dfe3e6;
          }

          .cmt_reply_btn:hover{
            text-decoration: underline;
          }
          .cmt_reply{
            padding-top: 10px;
            padding-bottom: 10px;
            padding-left: 20px;
            padding-right: 20px;
            border-bottom: 1px solid #dfe3e6;
          }
          .reply_main{
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
          }
          .reply_setting_btn{
            margin-top:-7px;
            font-size: 20px;
          }
          .dropdown_replymenu{
            left:0px;
            top:0px;
            width:60px;
            cursor: pointer;
            position: absolute;
            display: flex;
            flex-direction: column;
            border: 1px solid #dfe3e6;
            border-radius: 5px 5px;
            z-index: 2;
          }
          .cmt_input_area{
            min-height: 130px;
            border: 1px solid #dfe3e6;
            border-radius: 3px 3px;
            padding: 15px;
          }
          .input_cmt{
            border: 0px;
            width:100%;
            height: 60px;
            margin-bottom: 10px;
          }
          .input_cmt:focus{
            outline: none;
          }
          .cmt_input_btn{
            float: right;
            width: 60px;
            height: 30px;
            border-radius: 2px 2px;
            display:flex;
            justify-content: center;
            align-items: center;
          }

          .cmt_reply_area{
            min-height: 130px;
            border: 1px solid #dfe3e6;
            border-radius: 3px 3px;
            padding: 15px;
            margin-top: 10px;
            margin-left: 20px;
            margin-bottom: 10px;
          }
          .input_reply{
            border: 0px;
            width:100%;
            height: 60px;
            margin-bottom: 10px;
          }
          .input_reply:focus{
            outline: none;
          }
          .cmt_reply_btn{
            float: right;
            width: 60px;
            height: 30px;
            border-radius: 2px 2px;
            display:flex;
            justify-content: center;
            align-items: center;
          }

          .cmt_edit_area{
            min-height: 130px;
            border: 1px solid #dfe3e6;
            border-radius: 3px 3px;
            padding: 15px;
          }
          .input_edit{
            border: 0px;
            width:100%;
            height: 60px;
            margin-bottom: 10px;
          }
          .input_edit:focus{
            outline: none;
          }
          .cmt_edit_btn{
            float: right;
            width: 60px;
            height: 30px;
            border-radius: 2px 2px;
            display:flex;
            justify-content: center;
            align-items: center;
          }
          .cmt_edit_cancel_btn{
            float: right;
            margin-right: 10px;
            width: 60px;
            height: 30px;
            border: 1px solid  #dfe3e6;
            border-radius: 2px 2px;
            display:flex;
            justify-content: center;
            align-items: center;
            background-color: white;
          }

          .login_info_area{
            display:flex;
            justify-content: center;
          }
          .login_info{
            color: gray;
          }
        </style>
        <div class="post_area">
          <div class="post_header">
            <div class="post_type">
              <a href="/post/index?category=<%=post.category%>" class="a_basic post_type_text"><%=post.category%></a>
            </div>
            <div class="post_titleAndsetting">
              <span data-search-highlight="title"> <h3><%=post.title%></h3> </span>
              <span>
                <% if(whoami.passport&&post.author._id==whoami.passport.user._id){ %>
                <a href="#" class="post_setting_btn a_basic dot"> ··· </a>
                <% } %>
                <div class="dropdown_postmenu none">
                  <a href="/post/edit/<%=post._id%>" class="dd_ps_child a_basic"> 수정 </a>
                  <a href="#" onclick="clickPostDeleteBtn()" class="dd_ps_child a_basic"> 삭제 </a>
                </div>
              </span>
            </div>
            <div class="post_info">
              <span class="post_info_left">
                <span class="post_profile">
                  <a class="post_profile_img a_basic" href="#">
                    <img src="/public/images/profile.png">
                  </a>
                </span>
                <span class="post_userANDtime">
                  <div class="post_user">
                    <a href="/user/index/<%=post.author.isLeaved?'L':post.author.id%>" data-search-highlight="author" class="a_basic"><%=post.author.isLeaved?post.author.nickname.slice(13):post.author.nickname%></a>
                  </div>
                  <div class="post_time">
                    <a>
                      <%= post.createdAt.getYear()-100 %>.<%= post.createdAt.getMonth()+1>=10?post.createdAt.getMonth()+1:'0'+String(post.createdAt.getMonth()+1) %>.<%= post.createdAt.getDate()>=10?post.createdAt.getDate():'0'+String(post.createdAt.getDate()) %>
                      <%=post.createdAt.getHours()>=10? post.createdAt.getHours():'0'+String(post.createdAt.getHours())%>:<%= post.createdAt.getMinutes()>=10?post.createdAt.getMinutes():'0'+String(post.createdAt.getMinutes())%>%></a>
                  </div>
                </span>
              </span>
              <span class="post_info_right">
                <span class="post_figure_views">
                  <img src="/public/images/view.png">
                  <a class="figure a_basic"><%=post.view%></a>
                </span>
                <span class="post_figure_comments">
                  <img src="/public/images/comment.png">
                  <a class="figure a_basic"><%=post.comment%></a>
                </span>
                <span class="post_figure_likes">
                  <img src="/public/images/like.png">
                  <a class="figure a_basic"><%=post.like%></a>
                </span>
              </span>
            </div>
          </div>
          <div class="post_body" data-search-highlight="body">
            <%-post.body%>
          </div>
          <div class="post_footer">
            <div class="comment_area">
              <div class="post_figure">
                <a class="comment_amount a_basic"> 댓글 <%=post.comment%> </a>
                <% if(whoami.passport){ %>
                  <% if(IsLike) { %>
                <a href="/post/like/<%=post._id%>" class="a_basic like like_on"> ♥ </a>
                  <% } else {%>
                    <a href="/post/like/<%=post._id%>" class="a_basic like like_off"> ♡ </a>
                  <% } %>
                <% } %>

                <% if(IsLike) { %>
                <a class="like_cmt a_basic" style="opacity:50%;"> 게시글을 좋아합니다 ! </a>
                <% } else {%>
                <a class="like_cmt a_basic"> 게시글을 좋아합니다 ! </a>
                <% } %>
              </div>
              <ul class="comments">
                <% if(commentTrees.length){ %>
                <% commentTrees.forEach(function(comment){ %>
                <%if(comment.isDeleted&&comment.childComments){%>
                  <%var IsVisible=false%>
                  <%comment.childComments.forEach(function(childComment){%>
                    <%if(!childComment.isDeleted){%>
                      <%IsVisible=true%>
                    <%}%>
                  <%})%>
                  <%if(IsVisible){%>
                <li class="comment" commentId="<%=comment._id%>" commentText="<%=comment.text%>">
                  <a> 삭제된 댓글입니다. </a>
                  <%}else{%>
                <li class="none">
                  <%}%>
                <%}%>
                <%if(comment.isDeleted||comment.parentComment){%>
                <li class="none">
                <%}else{%>
                <li class="comment" commentId="<%=comment._id%>" commentText="<%=comment.text%>">
                <% } %>
                  <div class="comment_main" commentId="<%=comment._id%>">
                    <span class="cmt_left">
                      <span class="cmt_nickname">
                        <a class="a_basic" href="/user/index/<%=comment.author.isLeaved?'L':comment.author.id%>"> <%=comment.author.isLeaved?comment.author.nickname.slice(13):comment.author.nickname%> </a>
                      </span>
                      <% if(isAuthenticated){ %>
                      <span onclick="clickComment(this);" class="cmt_content">
                        <a> <%=comment.text%> </a>
                      </span>
                      <% } else { %>
                      <span class="cmt_content">
                        <a> <%=comment.text%> </a>
                      </span>
                      <% } %>
                    </span>
                    <span class="cmt_right">
                      <span class="cmt_time">
                        <a> <%= comment.createdAt.getYear()-100 %>.<%= comment.createdAt.getMonth()+1>=10?comment.createdAt.getMonth()+1:'0'+String(comment.createdAt.getMonth()+1) %>.<%= comment.createdAt.getDate()>=10?comment.createdAt.getDate():'0'+String(comment.createdAt.getDate()) %> </a>
                        <a> <%= comment.createdAt.getHours()>=10? comment.createdAt.getHours():'0'+String(comment.createdAt.getHours())%>:<%= comment.createdAt.getMinutes()>=10?comment.createdAt.getMinutes():'0'+String(comment.createdAt.getMinutes())%>%> </a>
                      </span>
                      <% if(whoami.passport&&comment.author._id==whoami.passport.user._id){ %>
                      <a href="#" class="comment_setting_btn a_basic dot"> ··· </a>
                      <% } %>
                    </span>
                  </div>

                  <% if(comment.childComments){ %>
                  <% comment.childComments.forEach(function(childComment){ %>
                  <%if(childComment.isDeleted){%>
                  <li class="none">
                  <%}else{%>
                  <li class="cmt_reply" commentId="<%=childComment._id%>" commentText="<%=childComment.text%>">
                  <% } %>
                    <div class="reply_main" commentId="<%=childComment._id%>">
                      <span class="cmt_left">
                        <span class="cmt_nickname">
                          <a class="a_basic" href="/user/index/<%=childComment.author.isLeaved?'L':childComment.author.id%>"> <%=childComment.author.isLeaved?childComment.author.nickname.slice(13):childComment.author.nickname%> </a>
                        </span>
                        <% if(isAuthenticated){ %>
                        <span class="cmt_content">
                          <a> <%=childComment.text%> </a>
                        </span>
                        <% } else { %>
                        <span class="cmt_content">
                          <a> <%=childComment.text%> </a>
                        </span>
                        <% } %>
                      </span>
                      <span class="cmt_right">
                        <span class="cmt_time">
                          <a> <%= childComment.createdAt.getYear()-100 %>.<%= childComment.createdAt.getMonth()+1>=10?childComment.createdAt.getMonth()+1:'0'+String(childComment.createdAt.getMonth()+1) %>.<%= childComment.createdAt.getDate()>=10?childComment.createdAt.getDate():'0'+String(childComment.createdAt.getDate()) %> </a>
                          <a> <%= childComment.createdAt.getHours()>=10? childComment.createdAt.getHours():'0'+String(childComment.createdAt.getHours())%>:<%= childComment.createdAt.getMinutes()>=10?childComment.createdAt.getMinutes():'0'+String(childComment.createdAt.getMinutes())%>%> </a>
                        </span>
                        <% if(whoami.passport&&childComment.author._id==whoami.passport.user._id){ %>
                        <a href="#" class="reply_setting_btn a_basic dot"> ··· </a>
                        <% } %>
                      </span>
                    </div>
                  </li>
                  <% }) %>
                  <% } %>

                </li>
                <% }) %>
                <% } %>
              </ul>

              <div class="none dropdown_commentmenu">
                <a onclick="doEdit(this);" class="dd_cs_child a_basic"> 수정 </a>
                <a onclick="doDelete(this);" class="dd_cs_child a_basic"> 삭제 </a>
              </div>
              <div class="none dropdown_replymenu">
                <a onclick="doEditReply(this);" class="dd_cs_child a_basic"> 수정 </a>
                <a onclick="doDeleteReply(this);" class="dd_cs_child a_basic"> 삭제 </a>
              </div>

              <div class="cmt_reply_area none">
                <textarea class="input_reply" placeholder="답글을 입력하세요."></textarea>
                <div onclick="inputReply()" class="cmt_reply_btn cursor_pointer alert-secondary">
                  <a href="#" class="a_basic"> 등록 </a>
                </div>
              </div>

              <div class="cmt_edit_area none">
                <textarea class="input_edit" placeholder="댓글을 입력하세요."></textarea>
                <div onclick="inputEdit(this)" class="cmt_edit_btn cursor_pointer alert-secondary">
                  <a class="a_basic cursor_pointer"> 수정 </a>
                </div>
                <div onclick="clickEditCancelBtn(this)" class="cmt_edit_cancel_btn cursor_pointer alert-secondary">
                  <a class="a_basic cursor_pointer"> 취소 </a>
                </div>
              </div>

              <% if(isAuthenticated){ %>
              <div class="cmt_input_area">
                <textarea class="input_cmt" placeholder="댓글을 입력하세요."></textarea>
                <div onclick="inputComment()" class="cmt_input_btn cursor_pointer alert-secondary">
                  <a class="a_basic cursor_pointer"> 등록 </a>
                </div>
              </div>
              <% } else {%>
                <div class="login_info_area">
                  <a href="/login" class="login_info"> 로그인 후 댓글 기능을 이용하실 수 있습니다. </a>
                </div>
              <% } %>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        <a id="post_info" postId='<%=post._id%>'></a>
        <%- include('../partials/footer') %>
      </div>
    </div>
  </body>
</html>
